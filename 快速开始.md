# 🚀 快速开始指南

## 一、项目概述

蓝牙助手（BlueApp）是一个基于 Android 的 BLE 通信应用，用于连接和控制支持低功耗蓝牙的硬件设备。

### 核心功能
- ✅ BLE 设备扫描和连接
- ✅ 实时传感器数据显示（转速、压力等）
- ✅ 工作模式控制（E/N/S/S+/R）
- ✅ 转速校准功能
- ✅ 300ms 周期性数据自动获取

---

## 二、环境准备

### 1. 开发工具
- **Android Studio**: Hedgehog 2023.1.1 或更高版本
- **JDK**: 11 或更高版本
- **Gradle**: 8.0+（项目已配置）

### 2. 测试设备
- **最低系统**: Android 8.0（API 26）
- **推荐系统**: Android 12+（更好的蓝牙体验）
- **必须支持**: 蓝牙 4.0+（BLE）

### 3. 硬件设备
- 支持 BLE GATT 协议的硬件设备
- 实现了功能文档中定义的通信协议
- 正常工作并处于广播状态

---

## 三、快速运行（5分钟）

### Step 1: 打开项目
```bash
1. 启动 Android Studio
2. 选择 "Open"
3. 选择项目文件夹
4. 等待 Gradle 同步完成
```

### Step 2: 连接设备
```bash
1. 使用 USB 连接 Android 手机/平板
2. 在设备上开启 "开发者选项" 和 "USB 调试"
3. Android Studio 顶部工具栏选择您的设备
```

### Step 3: 运行应用
```bash
1. 点击绿色的 ▶ "Run" 按钮
2. 等待编译和安装
3. 应用自动启动
```

### Step 4: 首次使用
```bash
1. 授予蓝牙权限（点击"授予权限"）
2. 授予位置权限（系统要求，用于 BLE 扫描）
3. 确保蓝牙已开启
4. 点击中央按钮开始扫描设备
```

---

## 四、使用流程

### 📱 扫描页面

```
┌─────────────────────────────┐
│    🔵 蓝牙助手               │
├─────────────────────────────┤
│                             │
│     ◯◯◯  扫描中  ◯◯◯        │
│                             │
├─────────────────────────────┤
│ 附近设备                     │
├─────────────────────────────┤
│ 📟 智能温湿度计              │
│    MAC: C4:5B:BE:89:1A:22   │
│    -45 dBm ■■■■             │
├─────────────────────────────┤
│ 🎧 MX-Audio-202             │
│    MAC: 88:21:4A:11:0B:CD   │
│    -72 dBm ■■□□             │
└─────────────────────────────┘
```

**操作**：
1. 点击"扫描中"按钮可暂停/继续扫描
2. 点击任意设备卡片进行连接

### 🎛️ 控制页面

```
┌─────────────────────────────┐
│ ← 智能温湿度计       ● 已连接 │
├─────────────────────────────┤
│           ╱│╲               │
│          ╱ │ ╲              │
│         ╱  │  ╲   1200      │
│        ╱   │   ╲   RPM      │
│       ╱    │    ╲           │
│      ◯─────●─────◯          │
│      1           15000      │
├─────────────────────────────┤
│ 压力: 2.50 bar   │ 当前模式  │
│ 250 kPa          │   N       │
│ 📈 ˄˄˄˄          │           │
├─────────────────────────────┤
│ 工作模式                     │
│ [ E ] [ N ] [ S ] [S+] [ R ]│
├─────────────────────────────┤
│ 目标转速                     │
│ ┌───────────────────────┐   │
│ │ 1500                  │   │
│ └───────────────────────┘   │
│ [-500][-100][+100][+500][发送]│
└─────────────────────────────┘
```

**操作**：
1. **查看数据**：实时显示转速和压力
2. **切换模式**：点击 E/N/S/S+/R 按钮
3. **校准转速**：输入目标值或使用快捷按钮，点击"发送"
4. **断开连接**：点击左上角返回按钮

---

## 五、协议说明

### 📤 发送指令

#### 1. 数据获取（自动，每300ms）
```
7E 7F 50 FB FD
```

#### 2. 模式切换
```
E模式:  7E 7F 00 FB FD
N模式:  7E 7F 01 FB FD
S模式:  7E 7F 02 FB FD
S+模式: 7E 7F 03 FB FD
R模式:  7E 7F 04 FB FD
```

#### 3. 转速校准（1500 RPM 示例）
```
7E 7F 60 DC 05 00 00 FB FD
         └───────────┘
         1500 (小端序)
```

### 📥 接收数据

设备返回格式：
```
7E 7F 30 [传感器数据 56字节]
```

包含：
- 10路模拟量输入/输出（VoltA-E）
- 频率输入和压力值
- 转速（RPM）
- 当前模式

---

## 六、常见问题

### ❓ 扫描不到设备

**原因**：
- 蓝牙未开启
- 缺少权限
- 设备未在广播模式
- 设备距离太远

**解决**：
```bash
1. 检查手机蓝牙是否开启
2. 确认已授予所有权限
3. 重启硬件设备
4. 靠近设备（建议 <5米）
5. 关闭其他蓝牙设备
```

### ❓ 连接失败

**原因**：
- 设备正在连接其他设备
- 蓝牙缓存问题
- 设备固件问题

**解决**：
```bash
1. 确保设备未连接到其他手机
2. 重启蓝牙：设置 → 蓝牙 → 关闭/开启
3. 清除蓝牙缓存：设置 → 应用 → 蓝牙 → 清除数据
4. 重启手机
5. 重启硬件设备
```

### ❓ 连接成功但无数据

**原因**：
- 设备固件未实现数据返回
- 通信特征值不匹配
- 数据格式错误

**解决**：
```bash
1. 查看 Android 日志：
   adb logcat -s BleManager
   
2. 检查是否有【TX】和【RX】日志

3. 确认设备固件版本

4. 联系硬件开发者
```

### ❓ 数据显示异常

**原因**：
- 数据字节顺序错误
- 数据包不完整
- 解析逻辑问题

**解决**：
```bash
1. 查看日志中的【RX】数据
2. 确认数据包头：7E 7F 30
3. 确认数据长度（至少59字节）
4. 检查字节顺序（应为小端序）
```

---

## 七、调试技巧

### 📊 查看日志

**使用 ADB**：
```bash
# 实时查看蓝牙日志
adb logcat -s BleManager

# 保存日志到文件
adb logcat -s BleManager > ble_log.txt

# 清空旧日志
adb logcat -c
```

**日志格式**：
```
BleManager: 【TX】7E 7F 50 FB FD
BleManager: 【RX】7E 7F 30 00 00 00...
BleManager: 解析成功：rpm=1200, pressure=250
```

### 🔍 分析数据包

**在线工具**：
- Float 转换：https://www.h-schmidt.net/FloatConverter/IEEE754.html
- 十六进制计算器：Windows 计算器（程序员模式）

**示例**：
```
十六进制: 33 33 33 3F
Float 值: 0.7

十六进制: DC 05 00 00 (小端序)
Int 值:   1500
```

### 🛠️ 修改配置

**调整轮询间隔**：
```kotlin
// 位置：BleProtocol.kt
const val POLL_INTERVAL_MS = 300L  // 改为 500L 降低频率
```

**调整转速范围**：
```kotlin
// 位置：DeviceControlScreen.kt
val maxRpm = 15000  // 修改最大值
val minRpm = 1      // 修改最小值
```

---

## 八、项目结构

```
BlueApp/
├── app/
│   ├── src/main/
│   │   ├── java/com/example/blueapp/
│   │   │   ├── bluetooth/
│   │   │   │   ├── BleProtocol.kt          # 协议定义 ⭐
│   │   │   │   ├── BleManager.kt           # BLE管理器 ⭐
│   │   │   │   ├── BluetoothAssistantApp.kt# 主应用 ⭐
│   │   │   │   ├── BluetoothScanScreen.kt  # 扫描界面
│   │   │   │   ├── DeviceControlScreen.kt  # 控制界面
│   │   │   │   └── TechUi.kt              # UI组件
│   │   │   └── MainActivity.kt            # 入口Activity
│   │   ├── AndroidManifest.xml            # 权限配置
│   │   └── res/                           # 资源文件
│   └── build.gradle.kts                   # 依赖配置
├── README.md                              # 项目说明
├── 协议实现说明.md                         # 协议详解
├── 快速开始.md                            # 本文件
└── 功能.md                                # 功能文档
```

**⭐ 核心文件**：
- `BleProtocol.kt`: 协议定义、指令生成、数据解析
- `BleManager.kt`: 蓝牙连接、数据收发、轮询管理
- `BluetoothAssistantApp.kt`: UI 与蓝牙的桥接层

---

## 九、下一步

### 🎯 学习路径

1. **基础使用**（已完成 ✅）
   - 运行应用
   - 扫描设备
   - 连接和查看数据

2. **理解协议**（推荐）
   - 阅读《协议实现说明.md》
   - 理解数据结构
   - 了解指令格式

3. **自定义开发**（进阶）
   - 添加新的传感器数据字段
   - 实现新的控制指令
   - 优化 UI 界面

### 📚 推荐阅读

1. **项目文档**：
   - `README.md` - 完整功能介绍
   - `协议实现说明.md` - 协议详细说明
   - `功能.md` - 原始需求文档

2. **Android 官方文档**：
   - [蓝牙低功耗 (BLE) 概览](https://developer.android.com/guide/topics/connectivity/bluetooth-le)
   - [Jetpack Compose](https://developer.android.com/jetpack/compose)

3. **BLE 协议**：
   - [蓝牙 GATT 规范](https://www.bluetooth.com/specifications/gatt/)

### 🎨 自定义开发示例

**添加新的数据显示卡片**：

```kotlin
// 位置：DeviceControlScreen.kt

@Composable
private fun VoltageCard(voltage: Float) {
    GlassCard(
        modifier = Modifier.fillMaxWidth(),
        corner = 16.dp,
    ) {
        Column {
            Text("电压", color = TechText, fontSize = 16.sp)
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = "${"%.2f".format(voltage)} V",
                color = TechPrimary,
                fontSize = 32.sp,
                fontWeight = FontWeight.Bold,
            )
        }
    }
}

// 在 DeviceControlScreen 中使用：
VoltageCard(voltage = sensorData?.voltAOut ?: 0f)
```

---

## 十、技术支持

### 📧 联系方式

- 项目 Issues: [GitHub Issues](#)
- 技术讨论: [论坛链接](#)

### 🐛 报告问题

提交 Issue 时请包含：
1. Android 版本和设备型号
2. 应用版本号
3. 详细的问题描述
4. ADB 日志（如果可能）
5. 复现步骤

### 🤝 贡献代码

欢迎提交 Pull Request！请遵循：
1. 代码符合 Kotlin 编码规范
2. 添加必要的注释
3. 测试通过后再提交
4. 描述清楚改动内容

---

## 🎉 开始使用

现在你已经了解了基本使用方法，快去连接你的设备吧！

如果遇到问题，请查看：
- **常见问题**（本文第六节）
- **协议实现说明.md**（详细技术文档）
- **Android 日志**（使用 `adb logcat`）

祝你使用愉快！ 🚀
